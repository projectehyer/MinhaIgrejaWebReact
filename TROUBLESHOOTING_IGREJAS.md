# SoluÃ§Ã£o de Problemas - Cadastro de Igrejas

## ğŸš¨ Problemas Comuns e SoluÃ§Ãµes

### 1. Erro 401 (NÃ£o Autorizado)

**Sintomas:**
- `Failed to load resource: the server responded with a status of 401`
- `SessÃ£o expirada. FaÃ§a login novamente.`

**Causas:**
- UsuÃ¡rio nÃ£o estÃ¡ logado
- Token de autenticaÃ§Ã£o expirou
- Token invÃ¡lido

**SoluÃ§Ãµes:**
1. **FaÃ§a login novamente:**
   - Acesse `http://localhost:3000/login`
   - Digite suas credenciais
   - VocÃª serÃ¡ redirecionado para o dashboard

2. **Verifique o arquivo .env:**
   ```env
   REACT_APP_SUPABASE_API_BASE_URL=https://uutmdodovftdaipqavpf.supabase.co
   REACT_APP_SUPABASE_API_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

3. **Reinicie o servidor:**
   ```bash
   npm start
   ```

### 2. Erro de Rede (Network Error)

**Sintomas:**
- `net::ERR_INTERNET_DISCONNECTED`
- `Network Error`
- `Erro de conexÃ£o. Verifique sua internet e tente novamente.`

**Causas:**
- Problemas de internet
- Supabase indisponÃ­vel
- Firewall bloqueando conexÃµes

**SoluÃ§Ãµes:**
1. **Verifique sua conexÃ£o com a internet**
2. **Teste o acesso ao Supabase:**
   - Acesse: https://uutmdodovftdaipqavpf.supabase.co
   - Deve carregar a pÃ¡gina do Supabase

3. **Verifique se o projeto estÃ¡ ativo:**
   - Acesse o painel do Supabase
   - Confirme se o projeto estÃ¡ ativo

### 3. Erro 404 (Tabela nÃ£o encontrada)

**Sintomas:**
- `Tabela de igrejas nÃ£o encontrada. Verifique a configuraÃ§Ã£o do Supabase.`

**Causas:**
- Tabela `igrejas` nÃ£o foi criada no Supabase
- Nome da tabela incorreto

**SoluÃ§Ãµes:**
1. **Crie a tabela no Supabase:**
   ```sql
   create table public.igrejas (
     id bigint generated by default as identity not null,
     created_at timestamp with time zone not null default now(),
     nome character varying null,
     logradouro character varying null,
     numero numeric null,
     complemento character varying null,
     bairro character varying null,
     id_cidade bigint null,
     id_uf bigint null,
     constraint igrejas_pkey primary key (id)
   ) TABLESPACE pg_default;
   ```

2. **Configure as polÃ­ticas RLS:**
   ```sql
   ALTER TABLE public.igrejas ENABLE ROW LEVEL SECURITY;
   
   CREATE POLICY "UsuÃ¡rios autenticados podem gerenciar igrejas" ON public.igrejas
   FOR ALL USING (auth.role() = 'authenticated');
   ```

### 4. Erro 422 (Dados InvÃ¡lidos)

**Sintomas:**
- `Dados invÃ¡lidos. Verifique os campos obrigatÃ³rios.`

**Causas:**
- Campos obrigatÃ³rios nÃ£o preenchidos
- Formato de dados incorreto

**SoluÃ§Ãµes:**
1. **Verifique se todos os campos obrigatÃ³rios estÃ£o preenchidos:**
   - Nome da Igreja
   - Logradouro
   - NÃºmero
   - Bairro
   - Estado (UF)
   - Cidade

2. **Verifique o formato dos dados:**
   - NÃºmero deve ser numÃ©rico
   - IDs de estado e cidade devem ser nÃºmeros

### 5. Erro 403 (Acesso Negado)

**Sintomas:**
- `Acesso negado. Verifique suas permissÃµes.`

**Causas:**
- PolÃ­ticas RLS muito restritivas
- UsuÃ¡rio sem permissÃµes adequadas

**SoluÃ§Ãµes:**
1. **Verifique as polÃ­ticas RLS:**
   ```sql
   -- PolÃ­tica mais permissiva para teste
   CREATE POLICY "Permitir tudo para usuÃ¡rios autenticados" ON public.igrejas
   FOR ALL USING (auth.role() = 'authenticated');
   ```

2. **Confirme se o usuÃ¡rio estÃ¡ autenticado:**
   - Verifique se o token estÃ¡ sendo enviado
   - Confirme se o usuÃ¡rio existe no Supabase

## ğŸ”§ VerificaÃ§Ãµes de DiagnÃ³stico

### 1. Verificar ConfiguraÃ§Ã£o do Supabase

```javascript
// No console do navegador, execute:
console.log('URL:', process.env.REACT_APP_SUPABASE_API_BASE_URL);
console.log('API Key:', process.env.REACT_APP_SUPABASE_API_KEY?.substring(0, 20) + '...');
```

### 2. Verificar Token de AutenticaÃ§Ã£o

```javascript
// No console do navegador, execute:
const user = JSON.parse(localStorage.getItem('user'));
console.log('Token:', user?.token?.substring(0, 20) + '...');
console.log('Email:', user?.email);
```

### 3. Testar ConexÃ£o com Supabase

```javascript
// No console do navegador, execute:
fetch('https://uutmdodovftdaipqavpf.supabase.co/rest/v1/igrejas', {
  headers: {
    'apikey': 'sua-api-key-aqui',
    'Authorization': 'Bearer seu-token-aqui'
  }
}).then(r => console.log('Status:', r.status));
```

## ğŸ“‹ Checklist de VerificaÃ§Ã£o

### âœ… PrÃ©-requisitos
- [ ] UsuÃ¡rio logado no sistema
- [ ] Arquivo `.env` configurado corretamente
- [ ] Projeto Supabase ativo
- [ ] Tabela `igrejas` criada
- [ ] PolÃ­ticas RLS configuradas
- [ ] ConexÃ£o com internet funcionando

### âœ… Teste de Funcionalidade
- [ ] Acessar AdministraÃ§Ã£o â†’ Igrejas
- [ ] Preencher formulÃ¡rio com dados vÃ¡lidos
- [ ] Selecionar estado e cidade
- [ ] Clicar em "Adicionar Igreja"
- [ ] Verificar se aparece na lista
- [ ] Testar ediÃ§Ã£o de igreja existente

## ğŸ†˜ Suporte

Se os problemas persistirem:

1. **Verifique os logs do console** do navegador
2. **Confirme a configuraÃ§Ã£o** do Supabase
3. **Teste a conectividade** com a API
4. **Verifique se o arquivo .env** estÃ¡ na raiz do projeto
5. **Reinicie o servidor** apÃ³s alteraÃ§Ãµes no .env

## ğŸ“ Logs Ãšteis

### Logs de Sucesso
```
Igreja salva com sucesso!
```

### Logs de Erro Comuns
```
Erro ao salvar igreja: AxiosError {message: 'Network Error'...}
SessÃ£o expirada ao buscar igrejas
Tabela de igrejas nÃ£o encontrada
``` 