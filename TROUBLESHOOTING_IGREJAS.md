# Solução de Problemas - Cadastro de Igrejas

## 🚨 Problemas Comuns e Soluções

### 1. Erro 401 (Não Autorizado)

**Sintomas:**
- `Failed to load resource: the server responded with a status of 401`
- `Sessão expirada. Faça login novamente.`

**Causas:**
- Usuário não está logado
- Token de autenticação expirou
- Token inválido

**Soluções:**
1. **Faça login novamente:**
   - Acesse `http://localhost:3000/login`
   - Digite suas credenciais
   - Você será redirecionado para o dashboard

2. **Verifique o arquivo .env:**
   ```env
   REACT_APP_SUPABASE_API_BASE_URL=https://uutmdodovftdaipqavpf.supabase.co
   REACT_APP_SUPABASE_API_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

3. **Reinicie o servidor:**
   ```bash
   npm start
   ```

### 2. Erro de Rede (Network Error)

**Sintomas:**
- `net::ERR_INTERNET_DISCONNECTED`
- `Network Error`
- `Erro de conexão. Verifique sua internet e tente novamente.`

**Causas:**
- Problemas de internet
- Supabase indisponível
- Firewall bloqueando conexões

**Soluções:**
1. **Verifique sua conexão com a internet**
2. **Teste o acesso ao Supabase:**
   - Acesse: https://uutmdodovftdaipqavpf.supabase.co
   - Deve carregar a página do Supabase

3. **Verifique se o projeto está ativo:**
   - Acesse o painel do Supabase
   - Confirme se o projeto está ativo

### 3. Erro 404 (Tabela não encontrada)

**Sintomas:**
- `Tabela de igrejas não encontrada. Verifique a configuração do Supabase.`

**Causas:**
- Tabela `igrejas` não foi criada no Supabase
- Nome da tabela incorreto

**Soluções:**
1. **Crie a tabela no Supabase:**
   ```sql
   create table public.igrejas (
     id bigint generated by default as identity not null,
     created_at timestamp with time zone not null default now(),
     nome character varying null,
     logradouro character varying null,
     numero numeric null,
     complemento character varying null,
     bairro character varying null,
     id_cidade bigint null,
     id_uf bigint null,
     constraint igrejas_pkey primary key (id)
   ) TABLESPACE pg_default;
   ```

2. **Configure as políticas RLS:**
   ```sql
   ALTER TABLE public.igrejas ENABLE ROW LEVEL SECURITY;
   
   CREATE POLICY "Usuários autenticados podem gerenciar igrejas" ON public.igrejas
   FOR ALL USING (auth.role() = 'authenticated');
   ```

### 4. Erro 422 (Dados Inválidos)

**Sintomas:**
- `Dados inválidos. Verifique os campos obrigatórios.`

**Causas:**
- Campos obrigatórios não preenchidos
- Formato de dados incorreto

**Soluções:**
1. **Verifique se todos os campos obrigatórios estão preenchidos:**
   - Nome da Igreja
   - Logradouro
   - Número
   - Bairro
   - Estado (UF)
   - Cidade

2. **Verifique o formato dos dados:**
   - Número deve ser numérico
   - IDs de estado e cidade devem ser números

### 5. Erro 403 (Acesso Negado)

**Sintomas:**
- `Acesso negado. Verifique suas permissões.`

**Causas:**
- Políticas RLS muito restritivas
- Usuário sem permissões adequadas

**Soluções:**
1. **Verifique as políticas RLS:**
   ```sql
   -- Política mais permissiva para teste
   CREATE POLICY "Permitir tudo para usuários autenticados" ON public.igrejas
   FOR ALL USING (auth.role() = 'authenticated');
   ```

2. **Confirme se o usuário está autenticado:**
   - Verifique se o token está sendo enviado
   - Confirme se o usuário existe no Supabase

## 🔧 Verificações de Diagnóstico

### 1. Verificar Configuração do Supabase

```javascript
// No console do navegador, execute:
console.log('URL:', process.env.REACT_APP_SUPABASE_API_BASE_URL);
console.log('API Key:', process.env.REACT_APP_SUPABASE_API_KEY?.substring(0, 20) + '...');
```

### 2. Verificar Token de Autenticação

```javascript
// No console do navegador, execute:
const user = JSON.parse(localStorage.getItem('user'));
console.log('Token:', user?.token?.substring(0, 20) + '...');
console.log('Email:', user?.email);
```

### 3. Testar Conexão com Supabase

```javascript
// No console do navegador, execute:
fetch('https://uutmdodovftdaipqavpf.supabase.co/rest/v1/igrejas', {
  headers: {
    'apikey': 'sua-api-key-aqui',
    'Authorization': 'Bearer seu-token-aqui'
  }
}).then(r => console.log('Status:', r.status));
```

## 📋 Checklist de Verificação

### ✅ Pré-requisitos
- [ ] Usuário logado no sistema
- [ ] Arquivo `.env` configurado corretamente
- [ ] Projeto Supabase ativo
- [ ] Tabela `igrejas` criada
- [ ] Políticas RLS configuradas
- [ ] Conexão com internet funcionando

### ✅ Teste de Funcionalidade
- [ ] Acessar Administração → Igrejas
- [ ] Preencher formulário com dados válidos
- [ ] Selecionar estado e cidade
- [ ] Clicar em "Adicionar Igreja"
- [ ] Verificar se aparece na lista
- [ ] Testar edição de igreja existente

## 🆘 Suporte

Se os problemas persistirem:

1. **Verifique os logs do console** do navegador
2. **Confirme a configuração** do Supabase
3. **Teste a conectividade** com a API
4. **Verifique se o arquivo .env** está na raiz do projeto
5. **Reinicie o servidor** após alterações no .env

## 📞 Logs Úteis

### Logs de Sucesso
```
Igreja salva com sucesso!
```

### Logs de Erro Comuns
```
Erro ao salvar igreja: AxiosError {message: 'Network Error'...}
Sessão expirada ao buscar igrejas
Tabela de igrejas não encontrada
``` 